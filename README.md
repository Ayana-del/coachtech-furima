# coachtech-furima

coachtech フリマアプリの開発プロジェクトです。

## アプリケーションの概要

本アプリケーションは、ユーザーが商品を自ら出品・購入できるフリマプラットフォームです。

## 使用技術（実行環境）

開発環境および使用している主要な技術スタックは以下の通りです。

### 1. 開発インフラ / サーバー構成

| 項目         | 技術 / バージョン                            |
| ------------ | -------------------------------------------- |
| インフラ     | Docker / Docker Compose                      |
| Web サーバー | Nginx 1.21.1                                 |
| データベース | MySQL 8.0.35                                 |
| ツール       | phpMyAdmin (DB 管理), MailHog (メールテスト) |

### 2. バックエンド (Backend)

| 項目           | 技術 / バージョン                                |
| -------------- | ------------------------------------------------ |
| 言語           | PHP 8.1                                          |
| フレームワーク | Laravel 8.x                                      |
| 認証パッケージ | Laravel Fortify (会員登録・ログイン・メール認証) |  
| 決済 SDK | Stripe PHP(クレジットカード・コンビニ決済の実装) |  


### 3. フロントエンド (Frontend)

| 項目                 | 技術             |
| -------------------- | ---------------- |
| テンプレート | Blade            |
| スタイリング         | CSS (Native CSS) |

## 環境構築手順

クローン後、以下の手順で開発環境を起動できます。

### 1.リポジトリのクローン

```bash
git clone https://github.com/Ayana-del/coachtech-furima.git
```

```bash
cd coachtech-furima
```
### 2.環境設定ファイルの準備

```bash
cp src/.env.example src/.env
```
  
### 3.Docker コンテナの構築・起動

```bash
docker-compose up -d --build
```
  
### 4.依存パッケージのインストールとキー生成
```bash  
docker-compose exec php composer install  
```
  
```bash
docker-compose exec php php artisan key:generate
```

### 5.マイグレーションの実行

```bash
docker-compose exec php php artisan migrate
```
  
### 6.「シンボリックリンク」の作成を追加  
ブラウザからアップロード画像等を表示できるようにするため、以下のコマンドを実行してください。  
  
```bash
docker-compose exec php php artisan storage:link  
```  
  
### 7.初期データの投入

開発および動作確認のため、以下の手順でダミーデータを投入してください。

```bash
docker-compose exec php php artisan migrate:fresh --seed
```
  
データの整合性を保つため、以下の順序でシーディングを実行する構成としています。  
  
■ シーダー実行順序  
1. UsersTableSeeder:認証ユーザーの作成  
2. ProfilesTableSeeder:各ユーザーのプロフィール（住所等）作成  
3. CategorySeeder:商品カテゴリーのマスター作成  
4. ConditionsTableSeeder:商品状態のマスター作成  
5. ItemsTableSeeder:商品サンプルの作成  
  
- 1. テスト用アカウント  
ログインおよび動作確認用のユーザー情報です。  
| 役割 | 名前 | メールアドレス | パスワード | メール認証 |  
| ---- | ---- | ---- | ---- | ---- |  
| 出品者 | テストユーザー | test@example.com | password123 | 済み |  
| 購入者 | 購入者 次郎 | buyer@example.com | password123 | 済み |  
| 未認証 | 未認証 三郎 | guest@example.com | password123 | 未完了 |  
  
- 2. プロフィール初期データ  
各ユーザーに紐づく配送先・基本情報です。  
  
| ユーザーID | 氏名 | 郵便番号 | 住所 | 建物名 |  
| ---- | ---- | ---- | ---- | ---- |  
| 1 | テスト 太郎 | 123-4567 | 東京都渋谷区道玄坂2-11-1 | テックビル101 |  
| 2 | 購入者 次郎 | 530-0001 | 大阪府大阪市北区梅田1-1 | 梅田タワー20F |  
| 3 | 未認証 三郎 | 810-0001 | 福岡県福岡市中央区天神1-1 | 天神プラザ5F |  
  
- 3. カテゴリー（マスタデータ）  
以下の１４種類のカテゴリーを登録し、商品に複数紐付け可能な構成としています。  
・ファッション  
・家電  
・インテリア  
・レディース  
・メンズ  
・コスメ  
・本  
・ゲーム  
・スポーツ  
・キッチン  
・ハンドメイド  
・アクセサリー  
・おもちゃ  
・ベビー・キッズ  
  
- 4. 商品の状態（マスタデータ）  
・良好  
・目立った傷や汚れなし  
・やや傷や汚れあり  
・状態が悪い  
  
- 5. 商品サンプルデータ  
ユーザーID:1（出品者）により登録された、動作確認用の商品10点です。画像は外部S3ストレージのURLを参照しています。  
  
| 商品名 | 価格 | ブランド | 商品の状態 | 商品説明 |  
| ---- | ---- | ---- | ---- | ---- |  
| 腕時計 | ¥15,000 | Rolax | 良好 | スタイリッシュなデザインのメンズ時計 |  
| HDD | ¥5,000 | 西芝 | 目立った傷や汚れなし | 高速で信頼性の高いハードディスク |  
| 玉ねぎ3束 | ¥300 | - | 良好 | 新鮮な玉ねぎ3束のセット |  
| 革靴 | ¥4,000 | - | やや傷や汚れあり | クラシックなデザインの革靴 |  
| ノートPC | ¥45,000 | - | 良好 | 高性能なノートパソコン |  
| マイク | ¥8,000 | - | 良好 | 高音質のレコーディング用マイク |  
| ショルダーバッグ | ¥3,500 | - | 良好 | おしゃれなショルダーバッグ |  
| タンブラー | ¥500 | - | 良好 | 使いやすいタンブラー |  
| コーヒーミル | ¥4,000 | Starbacks | 良好 | 手動のコーヒーミル |  
| メイクセット | ¥2,500 | - | 良好 | 便利なメイクセットアップセット |  
  
■テストデータの使用に関する注意点  
php artisan db:seedによって生成されるサンプル商品データには、以下の仕様が含まれます。  
  
・カテゴリの自動割り当て：商品出品時の「カテゴリー必須」という要件を満たすため、Factoryを用いて全商品に１〜３個のカテゴリーをランダムに紐づけています。  
  
・内容の生合成について:ランダム抽選による紐付けのため、「商品名とカテゴリーの内容が一致しない（例：食品に家電カテゴリーがつく等）」場合があります。これは、あくまでシステム上のバリデーションおよび表示確認を目的としたデータ生成仕様であり、不具合ではありません。  
  

## 開発・管理ツール  
環境構築完了後、以下の URL から各機能にアクセスできます。  
  
| サービス名 | URL | 備考 |  
| ---- | ---- | ---- |  
| アプリケーション本体 | http://localhost | 動作確認用メインページ |  
| phpMyAdmin | http://localhost:8080 | データベース管理ツール |  
| MailHog / Mailtrap | http://localhost:8025 | 送信メール確認用 |  

■phpMyAdmin 接続情報  
データベースの値を直接確認・変更する際は、以下の設定でログインしてください。  
  
サーバー名: mysql  
ユーザー名: laravel_user  
パスワード: laravel_pass

## ER 図

![ER図](./er-diagram.drawio.png)

## データベース設計  
本プロジェクトは、機能要件に基づき、９つのテーブルで構成されています。  
  
| テーブル名 | 役割 |  
| ---- | ---- |  
| users | ユーザー認証情報（氏名、メールアドレス、パスワード）を管理します。 |  
| profiles | ユーザーの基本情報（自己紹介画像、住所、本人氏名）を保持します。 |  
| items | 出品された商品の詳細（名前、価格、説明、ブランド等）を管理します。 |  
| conditions | 商品の状態（「良好」「状態が悪い」など）を管理するマスターテーブルです。 |  
| categories | 商品の分類名（「ファッション」「家電」など）を管理するマスターテーブルです。 |  
| category_item | 商品とカテゴリーを多対多で紐づけるための中間テーブルです。 |  
| comments | 商品に対するユーザーからのコメント内容を保持します（最大255文字。 |  
| likes | どのユーザーがどの商品に「いいね」をしたかの履歴を管理します。 |  
| orders | 商品の購入履歴および、購入確定時の支払い方法と配送先住所を保持します。 |  

## モデル・リレーション定義  
Eloquent モデルにおけるリレーションシップの定義一覧です。  
  
■Userモデル  
| メソッド名 | リレーション | 相手モデル | 内容 |  
| ---- | ---- | ---- | ---- |  
| profile() | hasOne | Profile | ユーザーのプロフィール情報を取得 |  
| items() | hasMany | Item | ユーザーが出品した全商品を取得 |  
| orders() | hasMany | Order | ユーザーが購入した商品の注文履歴を取得 |  
  
■Itemモデル  
| メソッド名 | リレーション | 相手モデル | 内容 |  
| ---- | ---- | ---- | ---- |  
| user() | belongsTo | User | 商品を出品したユーザーを特定 |  
| condition() | belongsTo | Condition | 商品の状態（マスター）を特定 |  
| categories() | belongsToMany | Category | 商品に紐付くカテゴリー（複数）を取得 |  
| comments() | hasMany | Comment | 商品に寄せられたコメント一覧を取得 |  
| likes() | hasMany | Like | 商品に付けられた「いいね」一覧を取得 |  
| orders() | hasOne | Order | 商品の注文情報を取得（売却済み判定に使用） |  
  
■Profileモデル  
| メソッド名 | リレーション | 相手モデル | 内容 |  
| ---- | ---- | ---- | ---- |  
| user() | belongsTo | User | プロフィールの所有ユーザーを特定 |  
  
■Categoryモデル  
| メソッド名 | リレーション | 相手モデル | 内容 |  
| ---- | ---- | ---- | ---- |  
| items() | belongsToMany | Item | カテゴリーに属する商品一覧を取得 |  
  
■Conditionモデル  
| メソッド名 | リレーション | 相手モデル | 内容 |  
| ---- | ---- | ---- | ---- |  
| items() | hasMany | Item | その状態に該当する商品一覧を取得 |  
  
■Orderモデル  
| メソッド名 | リレーション | 相手モデル | 内容 |  
| ---- | ---- | ---- | ---- |  
| user() | belongsTo | User | 商品を購入したユーザー（購入者）を特定 |  
| item() | belongsTo | Item | 購入された対象の商品を特定 |  
  
■Comment モデル  
| メソッド名 | リレーション | 相手モデル | 内容 |  
| ---- | ---- | ---- | ---- |  
| user() | belongsTo | User | コメントを投稿したユーザーを特定 |  
| item() | belongsTo | Item | コメントが投稿された対象の商品を特定 |  
  
■Like モデル  
| メソッド名 | リレーション | 相手モデル | 内容 |  
| ---- | ---- | ---- | ---- |  
| user() | belongsTo | User | 「いいね」をしたユーザーを特定 |  
| item() | belongsTo | Item | 「いいね」をされた対象の商品を特定 |  
  
## コントーローラー別機能定義  
各コントローラーが担当する画面と、具体的な処理内容の一覧です。  
  
1. ItemController(商品管理・表示)  
商品の閲覧、出品、いいね、コメント投稿といったメイン機能を担当します。  
| メソッド名 | 役割 | 処理内容 |  
| ---- | ---- | ---- |  
| index | 商品一覧表示 | 「おすすめ」「マイリスト」の切り替え、キーワード兼s買う、自分以外の出品商品の抽出。 |  
| show | 商品詳細表示 | 商品の詳細、コメント一覧の取得、いいね状態の判定。 |  
| toggleLike | いいねの切り替え | ログイン状態を確認し、いいねの登録と解除を交互に実行。 |  
| create | 出品画面表示 | カテゴリーマスター、商品状態を取得して出品フォームを表示。 |  
| store | 出品処理 | 商品画像の保存（storage）、商品データの登録、カテゴリーの多対多紐付け。 |  
| storeComment | コメント投稿 | 商品に対するユーザーのコメントをデータベースに保存。 |  
  
2. PurchaseController(決済・購入)  
Stripeを利用した決済フロート、購入完了後の注文データ作成を担当します。  
| メソッド名 | 役割 | 処理内容 |  
| ---- | ---- | ---- |  
| showPurchasePage | 購入確認画面 | 商品情報の表示と、配送先（DBまたはセッション）の確定。 |  
| storePurchase | 決済実行 | Stripe Checkoutを利用し、カード・コンビニ決済のセッションを作成・リダイレクト。 |  
| successPurchase | 購入完了処理 | 決済成功後、確定した配送先情報を含めてordersテーブルに記録。 |  
  
3. ProfileController(プロフィール管理)  
ユーザー情報の変更と、初期設定時のユーザー体験（UX）制御を担当します。  
| メソッド名 | 役割 | 処理内容 |  
| ---- | ---- | ---- |  
| edit | プロフィール表示 | 現在のユーザー情報とプロフィール情報を取得し、編集画面を表示。 |  
| update | プロフィール更新 | 氏名、住所、画像の更新。初回登録時はトップ、２回目以降は編集画面へ遷移。 |  
  
4. AddressController(配送先変更)  
購入フロー中における、配送先住所の一時的または永続的な変更を担当します。  
| メソッド名 | 役割 | 処理内容 |  
| ---- | ---- | ---- |  
| editAddress | 住所変更画面 | 配送先を変更するための専用フォームを表示。 |  
| updateAddress |住所変更処理 | 選択により「プロフィールDBを更新」または「セッションに一時保存」を切り替え。 |  
  
5. MypageController(マイページ表示)  
ユーザー自身の活動履歴（出品・購入）の表示を担当します。  
| メソッド名 | 役割 | 処理内容 |  
| ---- | ---- | ---- |  
| index | マイページ表示 | 「出品した商品」「購入した商品」をタブ形式で表示し、それぞれ検索が可能。  

## ルーティング定義
1.公開ルート  
ログインの有無に関わらず、全てのユーザーがアクセス可能なルートです。  
  
| URL | メソッド | ルート名 | 担当コントローラー | 処理内容 |  
| ---- | ---- | ---- | ---- | ---- |  
| / | GET | item.index | ItemController@index | 商品一覧画面の表示 |  
| /item/{item_id} | GET | item.show | ItemController@show | 商品詳細画面の表示 |  
  
2. 要認証ルート（メールb認証済みユーザーのみ）  
ログインしており、かつメール認証（verified）が完了しているユーザーのみがアクセス可能なメイン機能です。  
| カテゴリ | URL | メソッド | ルート名 | 担当コントローラー | 処理内容 |  
| ---- | ---- | ---- | ---- | ---- | ---- |  
| ユーザー | /mypage | GET | mypage.index | MypageController@index | マイページの表示 |  
|         | /mypage/profile | GET | profile.edit | ProfileController@edit | プロフィール編集画面の表示 |  
|         | /mypage/profile | PATCH | profile.update | ProfileController@update | プロフィール情報の更新 |  
| 商品操作 | /sell | GET | item.create | ItemController@create | 商品出品画面の表示 |  
|         | /sell | POST | item.store | ItemController@store | 商品の出品登録処理 |  
|         | /item/{item_id}/like | POST | ItemController@toggleLike | いいねの登録・解除 |  
|.        | /item/{item_id}/comment | POST | comment.store | ItemController@storeComment | コメントの投稿 |  
| 購入・配送 | /purchase/{item_id} | GET | purchases.show | PurchaseController@showPurchasePage | 購入確認画面の表示 |  
|           | /purchase/{item_id} | POST | purchases.store | PurchaseController@storePurchase | Stripe決済実行 |  
|           | /purchase/success/{item_id} | GET | purchase.success | PurchaseController @successPurchase | 購入完了後のDB登録処理 |  
|           | /purchase/address/{item_id} | GET | addresses.edit | AddressController@editAddress | 配送先変更画面の表示 |  
|           | purchase/address/{item_id} | PATCH | addresses.update | AddressController@updateAddress | 配送先の更新（セッション・DB） |  
  
3. メール認証関連（認証プロセス）  
メール認証を完了させるためのフローおよび、認証リンククリック時の遷移を制御するルートです。  
| URL | メソッド | ルート名 | 処理内容 |  
| ---- | ---- | ---- | ---- |  
| /email/verify | GET | verification.notice | メール認証誘導画面（auth.verify-email）の表示 |  
| /email/verification-notification | POST | verification.send | 認証メールの再送信 |  
| /email/verify/{id}/{hash} | GET | verification.verify | 認証完了処理。完了後、「プロフィール編集画面」へ遷移。 |  


## ヘッダー機能  
共通レイアウトとして、全ページ（認証画面を除く）で利用可能なナビゲーションと検索機能を提供しています。  
  
1. 動的な検索機能  
表示されているページや選択中のタブに応じて、検索対象を自動的に切り替えます。  
| 現在のページ | 選択中のタブ | 検索対象 |  
| ---- | ---- | ---- |
| 商品一覧 | おすすめ | 自分以外の全商品から検索 |  
|         | マイリスト | 自分が「いいね」した商品の中から検索 |  
| マイページ | 出品した商品 | 自分が過去に出品した商品から検索 |  
|           | 購入した商品 | 自分が過去に購入した商品から検索 |  
  
検索の技術的仕様  
・状態の継承：GETパラメータとしてtab情報を隠しフィールド（hidden）で送信することで、検索後もタブの切り替え状態を維持します。  
・動的なアクション切り替え:閲覧中のURLがマイページ系（/mypage）か否かを判定し、フォームの送信先（action）を適切に切り替えます。  
  
2. ナビゲーションメニュー  
認証状態や現在のルートに応じて、表示項目を最適化しています。  
●認証状態による変化：
・未ログイン：「ログイン」「マイページ」「出品」を表示（クリック時はログイン画面へ誘導）。  
・ログイン済み：「ログアウト」「マイページ」「出品」を表示。  
  
●非表示制御：会員登録、ログイン、メール認証誘導画面では、主要な操作に集中させるため検索窓やナビゲーションを非表示にしています。  
  
## メール認証機能  
本アプリケーションでは、セキュリティとユーザーの本人確認を担保するため、特定の操作に対してメール認証を必須としています。  
  
1. 認証状態によるアクセス制限  
メール認証の状況に応じて、アクセスできる範囲が厳密にコントロールされています。  
| 認証状態 | アクセス可能な画面・機能 |  
| ---- | ---- |  
| 未認証(ゲスト含む) | 商品一覧の閲覧、商品詳細の閲覧 |  
| ログイン済み・メール未認証 | マイページ（一部制限）、認証誘導画面 |  
| ログイン済み・メール認証済み | 全機能（出品、購入、いいね、コメント、配送先変更、プロフィール編集など） |  
  
2. 認証誘導画面  
メール認証が必要な機能（出品や購入など）へアクセスしようとした未認証ユーザーに対して表示されます。  
  
・役割：メール内のリンクをクリックして会員登録を完了させるようユーザーに促します。  
  
・再送機能：verification.sendルートを利用し、認証メールを再送信するボタンを設置しています。  
  
3. UX(ユーザー体験)の制御  
・ナビゲーションの制限：この画面ではヘッダーの検索窓やメニューを非表示にし、ユーザーが「認証を完了させる」という唯一のタスクに集中できるように設計されています。  
  
・認証後の遷移：メール内のリンクをクリックして認証が完了すると、自動的にプロフィール編集画面へリダイレクトされ、初期設定を促すフローになっています。  
  
## 会員登録

### 1.実装済み機能

・ユーザー登録：ユーザー名、メールアドレス、パスワードによる新規アカウント作成。  
・バリデーション：FormRequest を使用したサーバーサイドでの入力チェック。  
・メール認証：新規登録時の本人確認メール送信機能追加。  
・レスポンシブ・デザイン：PC(1400px - 1540px)とタブレット(768px - 850px)に対応。

### 2.実装ファイル一覧

| ファイルパス                                | 役割・実装内容                                          |
| ------------------------------------------- | ------------------------------------------------------- |
| app/Http/Requests/RegisterRequest.php       | バリデーション定義ルール・指定エラーメッセージの定義    |
| routes/web.php                              | メール認証完了後の /mypage/profile へのリダイレクト制御 |
| config/fortify.php                          | 認証済みユーザーの Home（/） 設定                       |
| resources/views/auth/register.blade.php     | 会員登録画面のマークアップ                              |
| resources/views/auth/verify-email.blade.php | メール認証誘導画面                                      |

### 3.ユーザー登録・遷移フロー

・登録後のフロー：会員登録語、メール認証誘導画面を表示します。認証未完了ユーザーは、ログイン後も自動的にこの画面へ誘導されるよう制御しています。

・認証完了後のリダイレクト:メールの認証リンクをクリックした初回のみ、必須情報の登録を促すため プロフィール設定画面（/mypage/profile） へ自動遷移します。

・通常ログイン時: 二回目以降のログイン時は、利便性を考慮し 商品一覧ページ（/） または マイページ（/mypage） へ遷移するよう、config/fortify.php にてカスタマイズ済みです。

## ログイン・認証制限機能の実装

### 1.実装済み機能

・ユーザー認証：登録済みメールアドレスとパスワードによる認証処理。  
・バリデーション：LoginRequest による入力チェックおよび日本語メッセージの返却。  
・未認証リダイレクト：Authenticate ミドルウェアにより、未ログイン状態での保護ページアクセスをログイン画面へ強制誘導。  
・画面間遷移制限：ログイン画面と会員登録画面を相互に遷移可能な動線を構築。

### 2.実装ファイル

ログイン認証および、ユーザー状態に応じたリダイレクト制御に関連する主要ファイルは以下の通りです。  
| ファイルパス | 役割・実装内容 |
| ------------------------------------ | -------------------------------------------------- |
| app/Http/Requests/LoginRequest.php | ログイン専用のバリデーションルール・メッセージ定義 |
| resources/views/auth/login.blade.php | ログイン画面 |
| public/css/auth/auth.css | 会員登録画面・ログイン画面共通デザイ |
| config/fortify.php | 認証済みユーザーの標準リダイレクト先（home）の設定 |  
| routes/web.php | 初回メール認証完了時のプロフィール画面遷移ロジックを実装 |  
| app/Http/Middleware/Authenticate.php | 未ログイン状態でのアクセス制限とログイン画面への誘導 |

### 3.機能要件に基づく挙動

・アクセス制限:認証が必要なページ（マイページや購入画面など）への未ログインアクセスを検知した際、自動的にログイン画面へ遷移させます。

・未認証ユーザーの保護:ログイン済みであっても、メール認証が完了していないユーザーが保護ページへアクセスした場合は、自動的に メール認証誘導画面（/email/verify） へ遷移させ、機能を制限します。

・認証後の遷移最適化: 認証成功後のリダイレクト先は、ユーザーの状態に応じて以下の通り動的に切り替えます。  
　・初回メール認証完了時: プロフィール設定画面（必須情報登録を優先）  
　・通常ログイン時: 商品一覧画面

・エラーフィードバック:ログイン不備がある場合、「ログイン情報が登録されていません」などの指定されたメッセージを表示し、ユーザーへ通知します。

## ■ 商品一覧・マイリスト・検索機能

### 1. 実装済み機能

・商品一覧表示（おすすめ）: 全商品の画像・名称を表示。購入済み商品は「Sold」ラベルを表示。

・出品者除外ロジック: ログイン中の場合、自分が出品した商品は一覧に表示されません（要件 FN014-4）。

・マイリスト機能: 「いいね」した商品のみを表示。未ログイン時は空の状態で安全に処理。

・インクリメンタル検索: ヘッダーの検索窓から「商品名」で部分一致検索が可能。タブを切り替えても検索ワードを維持するステートフルな検索機能を実装。

### 2. 実装ファイル  
| ファイルパス | 役割 | 実装内容 |  
| ---- | ---- | ---- |  
| app/Http/Controllers/ItemController.php | 一覧取得、自分以外の出品物抽出、検索ロジック |  
| resources/views/item/index.blade.php | おすすめ/マイリストのタブ切り替えおよび検索窓のUI |  
| app/Models/Item.php | 検索用スコープや購入済み判定（Sold）の定義 |  
  
## ■ マイページ機能  
### 1. 実装済み機能  
・プロフィール表示: ユーザー名、プロフィール画像の動的表示（未設定時のデフォルト画像対応）。  

・商品リストの出し分け:  

　・出品した商品: items テーブルより自身が user_id となっているデータを取得。  

　・購入した商品: orders テーブルとリレーションし、自身が購入した商品のみを抽出。  

・タブ切り替え UI: JavaScript を活用し、ページリロードなしで「出品物」と「購入物」を切り替える快適な操作感を提供。  
  
### 2. 実装ファイル  
| ファイルパス | 役割・実装内容 |  
| ---- | ---- |
| app/Http/Controllers/MypageController.php | 出品/購入商品の取得、プロフィールデータの統合 |  
| resources/views/mypage/index.blade.php | マイページUI、タブ切り替えスクリプト |  
| app/Models/User.php | items()（出品）および orders()（購入）のリレーション定義 |  
  
## ■ 商品詳細機能  
商品の詳細情報閲覧、お気に入り登録（いいね）、およびユーザー間のコミュニケーション（コメント）機能を提供します。  

### 1. 実装済み機能  
詳細情報の網羅的表示:  

・商品画像、商品名、ブランド、価格、商品説明を動的に表示。  

・複数カテゴリ対応: 商品に紐づく複数のカテゴリをすべてリスト表示。  

・情報の出し分け: 未認証ユーザーにも詳細情報の閲覧を許可。  

動的な「いいね」機能:  

・ログインユーザーはアイコン押下で「いいね」の登録/解除が可能。  

・リアルタイム反映: 押下後、合計カウント数が即座に増減し、アイコンの色が変化。  

コメント送信機能（要件 FN020）:  

・ログインユーザーのみコメント投稿が可能。  

・バリデーション: FormRequest を使用し、未入力チェックおよび最大255文字の制限を実装。  

・投稿後、コメント一覧に即時反映され、コメント総数も更新。  

購入動線:  

・「購入手続きへ」ボタンより、商品購入画面へシームレスに遷移。  

### 2. 実装ファイル一覧

| ファイルパス | 役割・実装内容 |
| ---- | ---- |
| app/Http/Controllers/ItemController.php | 詳細情報の取得、いいね数・コメント数の集計 |
| app/Http/Requests/CommentRequest.php | コメント投稿時のバリデーション（必須・255文字制限） |
| app/Http/Controllers/LikeController.php | いいねの登録・削除ロジック |
| app/Http/Controllers/CommentController.php | コメント保存および商品詳細へのリダイレクト処理 |
| resources/views/item/show.blade.php | 詳細画面のUI、カテゴリのループ表示、コメント一覧 |

## プロフィール編集画面  
ユーザーが自身の情報を管理するための「プロフィール編集画面」および、「ユーザー情報変更機能」を実装。  
### 1.対応要件一覧  
■ ユーザー情報変更機能  
以下の項も項について、過去の設定値を初期値として表示し、更新できる機能を実装しました。  
・プロフィール画像：  
 ・保存先：Laravelのstorage/app/public/profiles ディレクトリ  
 ・ブラウザ表示用のシンボリックリンク設定済み（php artisan storage:link）  
  
・ユーザー名: users テーブルおよび profiles テーブルとの連携  
  
・郵便番号: 8桁制限  
  
・住所: profiles テーブルへの保存  
  
・建物名: 任意入力項目として実装  
  
■ マイページ連携. 
・プロフィール表示: マイページにて画像とユーザー名が正しく取得・表示されることを確認。  
・動線: マイページからプロフィール編集画面への遷移ボタンを配置。  
  
### 2.技術的仕様  
・データベース構成: profiles テーブルを新規作成し、user_id による users テーブルとの外部キー制約（cascadeOnDelete）を設定。  
  
・画像処理:  
 ・画像未設定時はデフォルトのプレビュー（👤）を表示。  
  
・リアルタイム・プレビュー: JavaScriptを用いて、保存前に選択した画像を即座に確認可能。  
  
・画像削除機能: 任意でプロフィール画像を解除し、初期状態（画像なし）に戻せる機能。  
  
・スマート・アップロード: 新しい画像が保存される際、サーバー内の古い不要ファイルを自動削除するクリーン設計。  
### 3.使用技術・環境  
・Backend: PHP 8.x / Laravel 10.x (Eloquent ORM)  

・Frontend: JavaScript (File API), CSS3 (Responsive Design)  

・Database: MySQL / PostgreSQL (Unique Constraints)  

・Storage: Laravel Storage (Public Disk)  

## ■商品詳細機能  
商品の詳細情報の閲覧、お気に入り登録（いいね）、およびユーザー間のコミュニケーション（コメント）機能を提供します。  
  
### 1.実装済み機能  
詳細情報の網羅的表示:  
・動的データ出力: 商品画像、商品名、ブランド、価格、商品説明を ItemController より取得し表示。  
・複数カテゴリ対応: 商品に紐づく複数のカテゴリを foreach ループで一括表示。  
・閲覧制限の制御: 未認証（ゲスト）ユーザーでも詳細情報の閲覧が可能。  
  
動的な「いいね」機能:  
・インタラクション: ログインユーザーによるアイコン押下での登録/解除ロジック（ItemController）。  
・カウント反映: 押下後、合計カウント数が即座に更新され、アイコンの状態（色）が変化するよう実装。  
・リアルタイム性: 投稿完了後、自動的に詳細画面へリダイレクトし、最新のコメントと総件数を即時反映。  
  
### 2.実装ファイル一覧  
| ファイルパス | 役割 | 実装内容 |  
| ---- | ---- | ---- |  
| app/Http/Controllers/ItemController.php | 情報取得 | 商品詳細データのロード、いいね・コメント数の集計 |  
| app/Http/Requests/CommentRequest.php | 検証 | コメント投稿時のバリデーション（必須・255文字制限） |  
| app/Http/Controllers/ItemController.php | ロジック | いいねの登録・削除処理 |  
| app/Http/Controllers/ItemController.php | 保存 | コメントの保存、および投稿後の遷移制御 |  
| resources/views/item/show.blade.php | UI | 詳細画面のマークアップ、カテゴリ表示、コメントリスト |  
| public/css/item/show.css | スタイル | 商品詳細画面のデザイン |  
  
## ■商品出品機能  
ユーザーが所有する商品を出品するための機能を提供します。  
### 1.実装済み機能  
出品情報の登録ロジック:  
・動的バリデーション：商品名、商品説明、価格、コンディションを必須項目として検証。  
・柔軟なカテゴリ設計：ダミーデータとの整合性を重視し、カテゴリ未選択状態での出品も許容する「任意」しようとして実装。  
  
### 2.実装ファイル一覧  
| ファイルパス | 役割 | 実装内容 |  
| ---- | ---- | ---- |  
| app/Http/Controllers/ItemController.php | 画面表示 | 出品画面（create）の表示制御 |  
| app/Http/Controllers/ItemController.php | ロジック | 出品データの保存（store）処理 |  
| resources/views/items/create.blade.php | UI | 出品用フォーム、エラー表示、プレビュー枠のマークアップ |  
| public/css/items/create.css | スタイル | 商品出品画面のデザイン |  
  
## ■商品購入機能  
選択した商品の購入確認から、支払い方法の指定、購入確定までの一連のアクションを提供します。  
  
### 1.実装済みの機能  
購入確認プロセスの制御：  
・特定商品のデータ取得：item_idに基づき、購入対象の商品情報をコントローラで動的に特定。  
・例外処理の自動化：findOrFailを用いて、存在しない商品へのアクセス時に適切な404レスポンスを返却。  
  
購入確定アクション：  
・支払い方法の検証：購入ボタン押下時、支払い方法（payment_method）が選択されているかをサーバー側で厳密にチェック。  
・画面遷移：購入完了後、フラッシュメッセージと共に商品一覧画面へリダイレクトする事後処理を実装。  
・アクセス制限（認証ガード）：ログインおよびメール認証が完了したユーザー乗っみが購入アクションを実行できるようルーティングで制御。  
  
### 2.実装ファイル一覧  
| ファイルパス | 役割 | 実装内容 |  
| ---- | ---- | ---- |  
| app/Http/Controllers/PurchaseController.php | 画面表示 | showPurchasePage による購入確認画面のロード |  
| app/Http/Controllers/PurchaseController.php | ロジック | storePurchase による支払い方法の検証および購入確定処理 |  
| routes/web.php | ルーティング | 購入画面（GET）と購入アクション（POST）の定義、認証ミドルウェア適用 |  


