# coachtech-furima

coachtech フリマアプリの開発プロジェクトです。

## アプリケーションの概要

本アプリケーションは、ユーザーが商品を自ら出品・購入できるフリマプラットフォームです。

## 使用技術（実行環境）

・Backend: PHP 8.1/ Laravel 8.x  
・Frontend: Blade / CSS  
・nfrastructure: Docker / Docker Compose  
・Web Server: Nginx 1.21.1  
・Database: MySQL 8.0.35  
・Tool: phpMyAdmin / MailHog  
・Laravel Fortify  
・Blade  
・CSS

## 環境構築手順

クローン後、以下の手順で開発環境を起動できます。

### 1.リポジトリのクローン

```bash
git clone https://github.com/Ayana-del/coachtech-furima.git
```

```bash
cd coachtech-furima
```

### 2.Docker コンテナの構築・起動

```bash
docker-compose up -d --build
```

### 3.依存パッケージのインストール

```bash
cp src/.env.example src/.env
```

```bash
docker-compose exec php php artisan key:generate
```

### 5.マイグレーションの実行

```bash
docker-compose exec php php artisan migrate
```

### 6.初期データの投入

開発および動作確認のため、以下の手順でダミーデータを投入してください。

```bash
php artisan db:seed
```  
## URL(開発環境)

・アプリケーション本体: http://localhost  
・phpMyAdmin (DB 管理): http://localhost:8080  
　・サーバー名：mysql  
　・ユーザー名：laravel_user  
　・パスワード：laravel_pass

## ER 図

![ER図](./er-diagram.drawio.png)

## データベース設計　

本プロジェクトは、機能要件に基づき、９つのテーブルで構成されています。  
| テーブル名 | 役割 |  
| ---- | ---- |  
| users | ログインユーザーの認証情報を管理します。 |  
| profiles | ユーザーの詳細情報を保持します。 |  
| items | 出品情報を管理します。 |  
| categories | カテゴリ名を管理するマスターテーブルです。 |  
| category_item | 1つの商品に複数のカテゴリを紐づけるための中間テーブルです。 |  
| comments | 商品に対するユーザーからのコメント内容と投稿時間を保持します。 |  
| likes | どのユーザーがどの商品に「いいね」をしたのかの履歴を保持します。 |  
| orders | 購入確定時の商品ID、購入者ID、および配送先情報を保持します。 |  
| condition | 商品の状態を管理するマスタデーブルです。 |  
  

## モデル・リレーション定義
Eloquent モデルにおける主要なリレーションシップを以下に定義しています。  
  
■ User モデル  
| メソッド名 | リレーション | 相手モデル | 内容 |  
| ---- | ---- | ---- | ---- |  
| profile() | hasOne | Profile | 一つのプロフィールを保持 |  
| items() | hasMany | Item | 複数の商品を出品する |  
| comments() | hasMany | Comment | 複数のコメントを投稿する |  
| likes() | hasMany | Like | 複数の「いいね」を行う |  
| favoriteItems() | belongToMany | Item | 「いいね」した全商品を取得（マイリスト） |  
| orders() | hasMany | Order | 複数の購入（注文）履歴を持つ |  
  
■ Profile モデル  
| メソッド名 | リレーション | 相手モデル | 内容 |  
| ---- | ---- | ---- | ---- |  
| user() | belongsTo | User | 持ち主であるユーザーを特定 |  
  
■ Item モデル  
| メソッド名 | リレーション | 相手モデル | 内容 |  
| ---- | ---- | ---- | ---- |  
| user() | belongsTo | User | 出品者を特定 |  
| categories() | belongsToMany | Category | 複数のカテゴリに属する |  
| comments() | hasMany | Comment | 商品についた全コメントを取得 |  
| likes() | hasMany | Like | 商品についた「いいね」を取得 |  
| order() | hasOne | Order | 注文の有無で「購入済み」を判断 |  
  
■ Category モデル  
| メソッド名 | リレーション | 相手モデル | 内容 |  
| ---- | ---- | ---- | ---- |  
| items() | belongsToMany | そのカテゴリに属する全商品を取得 |  
  
■ Order モデル  
| メソッド名 | リレーション | 相手モデル | 内容 |  
| ---- | ---- | ---- | ---- |  
| user() | belongsTo | User | 購入者を特定 |  
| items() | belongsTo | 購入された商品を特定 |  
  
■ Comment モデル  
| メソッド名 | リレーション | 相手モデル | 内容 |  
| ---- | ---- | ---- | ---- |  
| user() | belongsTo | User | 投稿者を特定 |  
| items() | belongsTo | Item | 対象の商品を特定 |  
  
■Like モデル  
| メソッド名 | リレーション | 相手モデル | 内容 |  
| ---- | ---- | ---- | ---- |  
| user() | belongsTo | User | 「いいね」した人を特定 |  
| item() | belongsTo | Item | 対象の商品を特定 |  


## 会員登録・メール認証機能の実装

### 1.実装済み機能

・ユーザー登録：ユーザー名、メールアドレス、パスワードによる新規アカウント作成。  
・バリデーション：FormRequest を使用したサーバーサイドでの入力チェック。  
・メール認証：新規登録時の本人確認メール送信機能追加。  
・レスポンシブ・デザイン：PC(1400px - 1540px)とタブレット(768px - 850px)に対応。

### 2.実装ファイル一覧

| ファイルパス                            | 役割・実装内容                           |
| --------------------------------------- | ---------------------------------------- |
| app/Http/Requests/RegisterRequest.php   | バリデーション定義ルール・メッセージ定義 |
| resources/views/auth/register.blade.php | 会員登録画面                             |
| public/css/auth/auth.css                | 会員登録画面・ログイン画面共通デザイン   |

### 3.ユーザー登録・遷移フロー

・登録後の自動遷移: 会員登録成功後、スムーズにプロフィール設定（マイページ）へ誘導するため、Fortify の設定により遷移先を /mypage/profile にカスタマイズ済みです。

## ログイン・認証制限機能の実装

### 1.実装済み機能

・ユーザー認証：登録済みメールアドレスとパスワードによる認証処理。  
・バリデーション：LoginRequest による入力チェックおよび日本語メッセージの返却。  
・未認証リダイレクト：Authenticate ミドルウェアにより、未ログイン状態での保護ページアクセスをログイン画面へ強制誘導。  
・画面間遷移制限：ログイン画面と会員登録画面を相互に遷移可能な動線を構築。

### 2.実装ファイル

| ファイルパス                         | 役割・実装内容                                     |
| ------------------------------------ | -------------------------------------------------- |
| app/Http/Requests/LoginRequest.php   | ログイン専用のバリデーションルール・メッセージ定義 |
| resources/views/auth/login.blade.php | ログイン画面                                       |
| public/css/auth/auth.css             | 会員登録画面・ログイン画面共通デザイ               |

### 3.機能要件に基づく挙動

・アクセス制限：認証が必要なページへの未ログインアクセスを検知した際、自動的にログイン画面へ戻します。  
・エラーフィードバック：入力不備がある場合、設計書通りの日本語メッセージを表示し、再入力を促します。  
・認証後の遷移：認証成功後、ユーザーを適切なリダイレクト先へ安全に誘導します。

## 商品一覧画面・マイリスト検索機能

商品一覧画面では、全ユーザー向けの商品表示（おすすめ）と、ログインユーザー向けの「いいね」済み商品表示（マイリスト）をタブ形式で提供しています。

### 1.商品一覧取得（おすすめタブ）

ログインの有無に関わらず、出品されている商品を一覧で確認できる機能です。  
・表示内容：すべての商品について「商品画像」「商品名」を表示します。  
・販売ステータス：すでに購入された商品には「Sold」ラベルを表示し、一目で判別可能です。  
・表示制限：ログイン中の場合、「自分が出品した商品」は表示されないようクエリレベルで除外しています。  
・未認証ユーザー：会員登録前でも、すべての商品を閲覧することができます。

### 2.マイリスト一覧取得（マイリストタブ）

ログインユーザーが「いいね」した商品のみを抽出して表示する機能です。  
・抽出条件：ログインユーザーが過去に「いいね」した商品のみを表示します。  
・一貫性：おすすめタブと同様に、画像・名称・ラベルが表示されます。  
・未認証時の挙動：未認証ユーザーがマイリストを選択した場合は、「表示する商品がありません」と表示し、システムエラーを発生させない安全な設計としています。

### 商品検索機能

ヘッダーの検索窓から、欲しい商品を即座に絞り込むことができます。  
・検索方式：商品名に対する部分一致検索を採用しています。  
・状態の保持:  
 ・「おすすめ」で検索した状態で「マイリスト」へ切り替えても、検索キーワードは維持されます。  
 ・逆に「マイリスト」内での絞り込み状態を維持したまま「おすすめ」に戻ることも可能です。  
 ・リンクパラメータにキーワードを含めることで、シームレスな UI/UX を実現しています。
  
## マイページ機能  
ユーザーの登録情報（プロフィール）および、取引に関する商品の一覧を管理・表示する機能です。  
### 実装済み機能詳細  
ユーザー情報管理  
・動的プロフィール表示：ユーザーのプロフィール画像、ユーザー名をデータベースより取得し表示します。  
・デフォルト表示対応：プロフィール画像が未設定の場合、システム標準のアイコンを表示するフォールバック処理を実装しています。  
・編集画面連携：「プロフィールを編集」ボタンより、情報更新画面（profile.edit）へ遷移する導線を確保しています。  
  
商品リスト管理（タブ切り替え）  
・出品商品取得ロジック：ログインユーザーが作成（出品）した商品データーをitemテーブルより取得し表示します。  
・購入商品取得ロジック：ordersテーブルを介して、ログインユーザーが購入済みの商品のみを抽出・表示するwhereHasクエリを実装しています。  
・タブUI制御：avaScript（DOM操作）を用いて、画面遷移なしで「出品商品」と購入商品」の表示・非表示を切り替えるシングルページ的な挙動を実装しています。  
・空状態対応:表示対象の商品が存在しない場合、「出費した商品がありません」等のメッセージを条件分岐により表示します。  
  
